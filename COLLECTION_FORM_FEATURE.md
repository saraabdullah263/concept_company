# ميزة فورم الاستلام والطباعة للمندوبين

## الوصف
تم إضافة ميزة جديدة تسمح للمندوب بتسجيل تفاصيل الاستلام مباشرة عند الوصول للمستشفى/الجهة، مع إمكانية الطباعة الفورية للإيصال.

## كيفية الاستخدام

### 1. المندوب يصل للمحطة
- يضغط على زر "وصلت" عند الوصول للمستشفى

### 2. تسجيل بيانات الاستلام
- يظهر زر "تسجيل بيانات الاستلام"
- عند الضغط عليه، يفتح فورم يحتوي على:
  - **نوع النفايات**: (نفايات خطرة، أدوات حادة، مخلفات دوائية)
  - **عدد الأكياس**: رقم
  - **الوزن الإجمالي**: بالكيلوجرام
  - **ملاحظات**: حقل نصي اختياري
  - **توقيع المندوب**: توقيع إلكتروني
  - **توقيع العميل**: توقيع إلكتروني من الشخص المستلم

### 3. الطباعة
- بعد ملء جميع البيانات والتوقيعات، يضغط على "حفظ وطباعة"
- يفتح إيصال جاهز للطباعة بتصميم احترافي يحتوي على:
  - شعار الشركة
  - رقم الإيصال
  - التاريخ والوقت
  - بيانات الجهة
  - تفاصيل الاستلام
  - بيانات المندوب
  - التوقيعات الإلكترونية
  - QR Code للتتبع

### 4. المغادرة
- بعد الطباعة والتوقيع، يمكن للمندوب الضغط على "مغادرة المحطة"

## الملفات المضافة

1. **src/components/routes/CollectionFormModal.jsx**
   - مودال الفورم لإدخال بيانات الاستلام
   - يحتوي على حقول البيانات والتوقيعات الإلكترونية

2. **src/pages/PrintReceipt.jsx**
   - صفحة الطباعة بتصميم احترافي
   - تفتح في نافذة جديدة للطباعة

3. **add_collection_details_column.sql**
   - سكريبت SQL لإضافة عمود في قاعدة البيانات لحفظ تفاصيل الاستلام

## الملفات المعدلة

1. **src/components/routes/RouteStopCard.jsx**
   - تم استبدال الأزرار الثلاثة (وزن، صورة، توقيع) بزر واحد "تسجيل بيانات الاستلام"
   - زر الصورة أصبح اختياري

2. **src/pages/routes/RepresentativeRoute.jsx**
   - تمرير بيانات الرحلة للمكونات الفرعية

3. **src/App.jsx**
   - إضافة route جديد للطباعة: `/print-receipt`

## قاعدة البيانات

يجب تشغيل السكريبت التالي على قاعدة البيانات:
```sql
-- في Supabase SQL Editor
ALTER TABLE route_stops 
ADD COLUMN IF NOT EXISTS collection_details JSONB;
```

## المميزات

✅ فورم واحد متكامل بدلاً من خطوات متعددة
✅ توقيعين إلكترونيين (المندوب + العميل)
✅ طباعة فورية بتصميم احترافي
✅ حفظ تلقائي لجميع البيانات
✅ واجهة سهلة الاستخدام للمندوب
✅ إيصال يطابق المعايير المصرية

## ملاحظات

- التوقيعات يتم حفظها كـ base64 في قاعدة البيانات
- الإيصال يفتح في نافذة جديدة تلقائياً
- يمكن إعادة الطباعة من نفس النافذة
- جميع البيانات محفوظة في `collection_details` كـ JSON
